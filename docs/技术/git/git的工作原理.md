# git 的工作原理

## 分布式版本控制
每一个客户端都保留完整的文件历史记录。就算服务器发生异常，也能快速恢复。

![分布式版本控制](/git/distributed.png)

## 记录快照
 > 在 Git 中，每当你提交更新或保存项目状态时，它基本上就会对当时的全部文件创建一个快照并保存这个快照的索引。 为了效率，如果文件没有修改，Git 不再重新存储该文件，而是只保留一个链接指向之前存储的文件。 Git 对待数据更像是一个**快照流**。
![存储项目随时间改变的快照](/git/snapshots.png)
## 完整性
Git 中所有数据在存储前都计算校验和， 然后以校验和（可以理解为你提交的commit id）引用. 所以 Git 可以发现你的任何更改。
> Git 用来校验和的机制是 SHA-1 散列 （hash）。这是一个由 40个 十六进制字符组成的字符串.

> Git 数据库中保存的信息都是以文件内容的哈希值来索引

## 容错性
Git 只做 **添加** 数据操作， 意味着 你只要 commit 过的代码，就不可能丢失啦

## 三种状态
Git 将文件标记为三种状态：
> **已修改（modified）** 标识修改了文件，但还没有提交。

> **已暂存（staged）** 对修改文件做了标记，将包含在下次提交的快照中。简单说，就是 git add 了之后的文件

> **已提交（committed）** 安全的保存到本地数据库了。简单说，就是git commit 了

这也就对应我们常说的，工作区、暂存区、Git目录
![工作目录、暂存区域以及 Git 仓库](/git/areas.png)

> **工作区**是对项目的某个版本独立提取出来的内容。 这些从 Git 仓库的压缩数据库中提取出来的文件，放在磁盘上供你使用或修改。

> **暂存区**是一个文件，保存了下次将要提交的文件列表信息，一般在 Git 仓库目录中。 按照 Git 的术语叫做“索引”，不过一般说法还是叫“暂存区”。

> **Git 仓库目录**是 Git 用来保存项目的元数据和对象数据库的地方。 这是 Git 中最重要的部分，从其它计算机克隆仓库时，复制的就是这里的数据。

## 基本流程
> 1. 在工作区中修改文件。
> 2. 将你想要下次提交的更改选择性地暂存，这样只会将更改的部分添加到暂存区。(git add xxx)
> 3. 提交更新，找到暂存区的文件，将快照永久性存储到 Git 目录。(git commit xxx)

# `Git 内部原理`
## git 内部文件
.git 文件内部文件
```
config   // config 文件包含项目特有的配置选项。
description   // description 文件仅供 GitWeb 程序使用，我们无需关心
HEAD       //  HEAD 文件指向目前被检出的分支
hooks/     //  hooks 目录包含客户端或服务端的钩子脚本（hook scripts）
info/      // info 目录包含一个全局性排除（global exclude）文件， 用以放置那些不希望被记录在 .gitignore 文件中的忽略模式
objects/   // objects 目录存储所有数据内容
refs/      // refs 目录存储指向数据（分支、远程仓库和标签等）的提交对象的指针
index     // 这个是后续创建的，index 文件保存暂存区信息
```

## Git 对象
Git 是一个内容寻址文件系统。

这意味着，Git 的核心部分是一个简单的键值对数据库（key-value data store）


